model Chat {
  id          String   @id @default(uuid())
  name        String?
  avatar      String?
  description String?
  isGroup     Boolean  @default(false)
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  creator  User         @relation("ChatCreator", fields: [createdById], references: [id], onDelete: Restrict, onUpdate: Cascade)
  members  ChatMember[]
  messages Message[]

  @@index([createdById])
  @@index([updatedAt])
  @@map("chats")
}

model ChatMember {
  id          String    @id @default(uuid())
  chatId      String
  userId      String
  unreadCount Int       @default(0)
  lastReadAt  DateTime?
  joinedAt    DateTime  @default(now())

  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([chatId, userId])
  @@index([userId])
  @@index([chatId])
  @@map("chat_members")
}

model Message {
  id              String   @id @default(uuid())
  content         String?  @db.Text
  image           String?
  chatId          String
  senderId        String
  replyToId       String?
  isSystemMessage Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  sender User @relation("MessageSender", fields: [senderId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  @@index([chatId, createdAt])
  @@index([senderId])
  @@index([replyToId])
  @@map("messages")
}
